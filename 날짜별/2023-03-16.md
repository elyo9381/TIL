# 대기열 프로젝트

~~~
트래픽이 어느정도 있다는것은 사용자가 어느 정도 있다는것이고 
이것은 안정성이 매우 중요하다는것인데.... 
오픈 소스를 왜 굳이 만들어서 제공하려고 하는가 ?
~~~

```
대기열에서 특정 매칭 시스템 

뭘 매칭할건데 ? 
랜덤 채팅 -> 왜 만듬 ? 
대기열을 통한 실시간 랜덤 선물 사이트 -> 왜 만듬? 
```


## 왜 대기열 프로젝트인가. ?


> [! example] 내가 생각한 그럴싸한 이유 
> - ==상용 시스템 뿐이여서 비용절감을 위한 오픈소스제공을 위해서==
>	- SDK제공하여 사용되는  서버의 최소 자원으로 최대 효율을 내도록 진행
>- ==특정 대기열에 특화된 대기열이 아닌 범용 (플랫폼) 구축을위해==
>- ==대용량 트래픽 처리를 하기위해==
>- 기능이 더 추가된 대기열 프로젝트를 위해서
> 	- 어떤 기능을 추가 할껀데 


> [!example] 실질적인 이유 
>- 대량 트래픽을 경험 하고싶어서 
>	- Nosql , RDB
>	- syn, async
>- 동시성 처리에 대해서 
>	- Nosql , RDB
>- 찐한 OOP를 경험 하고 싶어서 
>	-  대기열에서 OOP를 어떻게 접목시키지 ? 
>	- 각종 설정을 OOP로 냄새나지 않는 코드를 만들게 된다면? 
>	- 객처 생성하고 GC처리하는 과정까지 모니터링 하고싶음 


### 대기열이란
- 자원이 부족한 컴퓨터가 많은양의 트래픽 만났을때, 쉽게 컨트롤 해주는 시스템

> [! question ] 대기열에서 가장 중요한 것을 무엇인가.  ?
>  !!! 물론 대기열이 죽으면 안되는것이다. 
>  대기열과 관련된 DB도 죽으면 안된다는 것이다. 

> [! question ] 상용 대기열 시스템 존재 하는가 ? 
>  다양한 업체가 존재한다. 
>  -   (주)에스티씨랩 - NetFUNNEL(넷퍼넬)
>  -   (주)웰컨 - TRACER v2.0
>  -   (주)데브와이 - MEGA-FENCE
 
> [! info ] 상용 시스템의 보편적인 기능들
>  - 대량 접속 제어 
>  - 페이지 노출 추적 
>  - 접속자, 이용자 추적
>  - 악성 Bot 탐지 및 차단
>  - 페이지 노출 추적
>  - 페이지 부하 추적
>  - 접속 유형 추적
>  - 접속 지역 및 단말 추적

> [! ] 어떻게 상용 시스템 보다 좋거나 특별 할까 ?
> - 서버가 일정 트래픽 이상 발생시 자동으로 대기열 서버가 동작 하면 아주 좋겠다. 

### 멘토님이 주신 근거 
-   server: 서비스를 위한 서버. 통상적인 서버처럼 비즈니스 로직과 도메인 모델 등을 담고 있음
-   SDK: 고객사 개발자들이 우리의 서비스를 통해 커스텀 티켓팅 서비스를 구현할 수 있는 Java SDK 제공



###  API 기반 대기열

대기열 구현을 어떻게 할것인가. ? 

==대기열 , 활성큐 ? ==
==대기열, 작업열==

- 유니크한 아이디
- 대용량 트래픽은 하나다.

- 진입기능
- 고객이 받는 정보 api

- redirect api? 
	- access어디론가 ? 
	- 응닶값을 주고 들어가는걸로 

- 연결중이라는걸 나타내야함 api로 
	- sesstion
	- 확실하게 작업열에 들어있는 사람인지
	- 요청 할때마다 작업열이든, 대기열이든 존재하는지  확인해서 연결되어 있다는걸 알수있다. 
- 클라이언트가 대기열 진입하면 대기번호, 세션정보를 저장해놓고 , 세션을 넘기고 , 위치를 확인할때마다 , 서버에서 세션이 있는지없는지

- 결제 성공시 
고객이 작업열을 빠져나왔을때, 작업열 끝났다고 알려주는 api가 있으면 좋면 

- 대기열 이탈
	- 세션에 시간을 붙여서

기능
api - 요청값 응닶값





피처
외부 기능 ( API )
- 대기열 진입 기능 
- 대기중 정보 조회 기능
- 작업열 조회 기능
- 작업열 아웃 조회 기능  
- 대기열 입장 카운트 설정 기능
- 행사정보 crud 기능
내부기능
- 대기열 입장 요청시 - 만료시간 업데이트 
- 대기열에서 막는기능 
	- 그리고 폴링을 한다던지 , 계속 요청하면 대규모 트래픽이 발생함
	- 이를 막을 방법 
		- 대기열에 존재하면 다시 반환 혹은 대기하라고 응닶갑 전송? 
- 대기열 스케줄링 기능 ( 이탈 하였는지 )
	- 대기열 입장 api 호출시 내부적으로 타임 체크 
	- 스케줄링을 돌려서 만료시간 지난 대기열 아이템은 제거 
- 대기열 -> 작업열 배치기능
- 작업큐 검증 기능 ( 몇명까지 작업 큐에 넣을지 )
- 유니크 아이디 폐쇠기능 ( 기존 유니크 아이디로 대기열 진입후 -> 나감 -> 유니크 아이디로 대기열 다시 접속)

api
- 대기열 진입 api
```
request
{
	"id" : unique value,
	"eventId" : ""
}

response 
{
	"id" : unique value,
	"eventId" : ""
	"status" : Enum( WAIT , ENTER , Block ),
	"expectedInfo" : {
		time : hh-mm,
		rank : Int
	},
	"successUrl" : "",
	"succeccToken" : "",
}
```

- 대기중 정보 확인 api (폴링)
```
request
{
	"id" : unique value,
	"eventId" : ""
}

response 
{
	"id" : unique value,
	"eventId" : ""
	"status" : Enum( WAIT , ENTER ),
	"expectedInfo" : {
		time : hh-mm,
		rank : Int
	},
	"successUrl" : "",
	"succeccToken" : "",
}

```

- 작업열 확인 api 
```
request
{
	"succeccToken" : 
}

response 
{
	"succeccToken" : "",
	
}

```

- 작업열 아웃 api - 입장서버(타 서버) 에서 작업종료 되었다고 알림을 받을 (web hook)
```
request
{
	"succeccToken" : 
}

response 
{
	"succeccToken" : ""
}
```


어드민
- 대기열 입장 카운트 설정  crud api
```
request
{
	"eventId" : ,
	"limitCnt" : Int,
	""
}

response 
{
	"succeccToken" : ""
}

```

- 행사정보 crud api ( domain )
```
eventId ( 행사 ID )
name 행사명
limitCnt 제한 인원 수 
status 상태
createAt
updatedAt
```




작업열 , 대기열 -> mysql , redis,  hashMap( LocalDataStruct ),.... ETC